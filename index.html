<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Hadeejâ€™Art</title>
<link href="https://fonts.googleapis.com/css2?family=Kenia&family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#F3CFB8; --text:#2b1e12; --muted:#6f5a4a;
  --brand:#d47a2c; --brand-700:#9e5317; --card:#fff6ee;
}
*{box-sizing:border-box}
html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font-family:Poppins,system-ui,Arial,sans-serif}
img{max-width:100%;display:block}
a{color:inherit;text-decoration:none}
.container{max-width:1100px;margin:0 auto;padding:18px}
.header{position:sticky;top:0;z-index:10;background:rgba(243,207,184,.88);backdrop-filter:blur(8px);border-bottom:1px solid #00000018}
.header .row{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:10px 0}
.brand{display:flex;align-items:center;gap:12px}
.brand .logo{width:56px;height:56px;border-radius:50%;background:#fff;border:2px solid #00000012;display:flex;align-items:center;justify-content:center;font-weight:900}
.brand .name{font-family:Kenia,cursive;font-size:28px;letter-spacing:.5px}
.actions{display:flex;align-items:center;gap:8px}
.icon-btn,.btn{border:0;border-radius:12px;padding:10px 14px;font-weight:800;cursor:pointer}
.icon-btn{background:var(--brand);color:#fff}
.btn{background:var(--brand);color:#fff}
.btn.secondary{background:#fff;color:var(--brand-700);border:1.5px solid var(--brand-700)}
.hero{display:grid;grid-template-columns:1.2fr .8fr;align-items:center;gap:18px;margin:14px 0;background:linear-gradient(180deg,#fff5ee,transparent);border:1px solid #00000012;border-radius:18px;padding:18px}
.hero .title{font-family:Kenia,cursive;font-size:40px;margin:0}
.hero .subtitle{color:var(--muted);margin-top:4px}
.hero .cta-row{margin-top:10px}
.cta-hero{display:inline-flex;align-items:center;gap:8px;border:0;border-radius:999px;padding:12px 18px;background:linear-gradient(180deg,var(--brand),var(--brand-700));color:#fff;font-weight:900;box-shadow:0 0 0 0 rgba(212,122,44,.55), 0 10px 24px rgba(0,0,0,.25);}
.cta-hero::after{content:'â†’'}
.grid{display:grid;grid-template-columns:repeat(3,1fr);gap:16px;margin:16px 0}
.card{background:#fff;border:1px solid #00000012;border-radius:16px;overflow:hidden;display:flex;flex-direction:column}
.card .body{padding:12px;display:flex;flex-direction:column;gap:6px}
.card .name{font-weight:800}
.card .price{color:var(--brand-700);font-weight:800}
.card .row{display:flex;gap:8px}
footer{padding:20px 0;color:var(--muted);text-align:center;border-top:1px dashed #00000020;margin-top:24px}

/* Bands (desktop/tablet) */
.band-top,.band-bottom{position:fixed;left:0;right:0;height:40px;background-repeat:repeat-x;background-size:auto 100%;z-index:2;pointer-events:none}
.band-top{top:0}
.band-bottom{bottom:0}
.band-top,.band-bottom{background-image:url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHdpZHRoPScyNDAnIGhlaWdodD0nODAnIHZpZXdCb3g9JzAgMCAyNDAgODAnPjxyZWN0IHdpZHRoPScyNDAnIGhlaWdodD0nODAnIGZpbGw9JyNGM0NGQjgnLz48cmVjdCB5PScwJyB3aWR0aD0nMjQwJyBoZWlnaHQ9JzYnIGZpbGw9JyM5ZTUzMTcnLz48cmVjdCB5PSc3NCcgd2lkdGg9JzI0MCcgaGVpZ2h0PSc2JyBmaWxsPScjOWU1MzE3Jy8+PGcgZmlsbD0nI2Q0N2EyYycgb3BhY2l0eT0nMC45JyB0cmFuc2Zvcm09J3RyYW5zbGF0ZSgwLDE4KSc+PHBhdGggZD0nTTAgMTIgTDEyIDAgTDI0IDEyIEwzNiAwIEw0OCAxMiBMNjAgMCBMNzIgMTIgTDg0IDAgTDk2IDEyIExxMDggMCBMMTIwIDEyIEwxMzIgMCBMMTQ0IDEyIEwxNTYgMCBMMTY4IDEyIEwxODAgMCBMMTkydiAxMiBMMjA0IDAgTDIxNiAxMiBMMjI4IDAgTDI0MCAxMiBWMjIgSDAgeicvPjwvZz48ZyB0cmFuc2Zvcm09J3RyYW5zbGF0ZSgwLDQ0KScgZmlsbD0nI2JiNzA1MSc+PHBhdGggZD0nTTAgMCBMMTAgMTIgTDIwIDAgWicvPjx1c2UgaHJlZj0nI3QnIHg9JzIwJy8+PHVzZSByZWY9JyN0JyB4PSc0MCcvPjx1c2UgcmVmPScjdCcg eD0nNjAnLz48dXNlIHJlZj0nI3QnIHg9JzgwJy8+PHVzZSByZWY9JyN0JyB4PScxMDAnLz48dXNlIHJlZj0nI3QnIHg9JzEyMCcvPjx1c2UgcmVmPScjdCcgeD0nMTQwJy8+PHVzZSByZWY9JyN0JyB4PScxNjAnLz48dXNlIHJlZj0nI3QnIHg9JzE4MCcvPjx1c2UgcmVmPScjdCcgeD0nMjAwJy8+PHVzZSByZWY9JyN0JyB4PScyMjAnLz48L2c+PGcg dHJhbnNmb3JtPSd0cmFuc2xhdGUoMCw2MCknIGZpbGw9JyM5ZTUzMTcnPjxjaXJjbGUgY3g9JzAnIGN5PSc2JyByPSczJy8+PHVzZSByeD0nJyBocmVmPScjZCcg eD0nMTYnLz48dXNlIGhyZWY9JyNkJyB4PSczMicvPjx1c2UgaHJlZj0nI2QnIHg9JzQ4Jy8+PHVzZSByZWY9JyNkJyB4PSc2NCcvPjx1c2UgaHJlZj0nI2QnIHg9JzgwJy8+PHVzZSByZWY9JyNkJyB4PSc5NicvPjx1c2UgaHJlZj0nI2QnIHg9JzExMicsLz48dXNlIGhyZWY9JyNkJyB4PScxMjgnLz48dXNlIGhyZWY9JyNkJyB4PScxNDQnLz48dXNlIGhyZWY9JyNkJyB4PScxNjAnLz48dXNlIGhyZWY9JyNkJyB4PScxNzYnLz48dXNlIGhyZWY9JyNkJyB4PScxOTInLz48dXNlIGhyZWY9JyNkJyB4PScyMDgnLz48dXNlIGhyZWY9JyNkJyB4PScyMjQnLz48L2c+PC9zdmc+');}

/* Drawer */
.backdrop{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;z-index:39}
.backdrop.show{display:block}
body.lock-scroll{overflow:hidden}
.drawer{position:fixed;top:0;right:-420px;bottom:0;width:380px;background:linear-gradient(180deg, rgba(255,246,238,.96), rgba(255,246,238,.92)), var(--bg);border-left:1px solid #00000018;display:none;z-index:40}
.drawer.open{right:0;display:flex}
.drawer .wrap{display:flex;flex-direction:column;width:100%;height:100%}
.drawer header{display:flex;align-items:center;justify-content:space-between;padding:12px 14px;border-bottom:1px solid #00000012;background:rgba(255,246,238,.95);backdrop-filter:blur(6px);position:sticky;top:0;z-index:1}
.drawer .items{flex:1;overflow:auto;padding:12px 10px;display:flex;flex-direction:column;gap:10px}
.item{display:grid;grid-template-columns:64px 1fr auto;gap:10px;background:#fff;border:1px solid #00000014;border-radius:12px;padding:8px}
.item img{width:64px;height:64px;object-fit:cover;border-radius:8px}
.item .meta b{font-size:14px}
.item .opts{font-size:12px;color:var(--muted)}
.item .qty{display:flex;align-items:center;gap:6px}
.totals{margin:6px 10px;border:1px solid #00000014;border-radius:12px;background:#fff}
.totals .line{display:flex;justify-content:space-between;padding:10px 12px}
.checkout{position:sticky;bottom:0;padding:12px 10px;background:linear-gradient(180deg, rgba(255,246,238,0.2), rgba(255,246,238,1) 40%);border-top:1px solid #00000012}
.checkout .btn{width:100%;border-radius:12px;padding:12px 16px;font-size:16px;box-shadow:0 10px 24px rgba(212,122,44,.35)}

/* Modal generic */
.modal{position:fixed;inset:0;display:none;place-items:center;z-index:50;background:rgba(0,0,0,.35)}
.modal .modal-content{background:#fff;border-radius:16px;max-width:900px;width:92vw;max-height:92vh;display:flex;flex-direction:column;overflow:hidden}
.modal-header,.modal-footer{padding:10px 12px;border-bottom:1px solid #00000012;background:#fff;display:flex;align-items:center;justify-content:space-between}
.modal-footer{border-top:1px solid #00000012;border-bottom:0}
.modal-body{padding:12px;overflow:auto}
.smallnote{font-size:12px;color:var(--muted)}
.inv-wrap{display:flex;justify-content:center;align-items:center}
.invoice{max-width:100%;max-height:75vh}

/* Responsive */
@media(max-width:920px){
  .grid{grid-template-columns:repeat(2,1fr)}
}
@media(max-width:720px){
  .band-top,.band-bottom{display:none}
  .hero{grid-template-columns:1fr;padding:14px;margin:10px 0;background:radial-gradient(120% 100% at 0% 0%, #fffdfa 0%, #fff2e8 40%, transparent 100%),linear-gradient(180deg,#fff5ee 0%, transparent 65%);}
  .hero .title{font-size:30px}
  .grid{grid-template-columns:repeat(2,1fr);gap:10px}
  .actions{display:none}
  .drawer{right:-100vw;width:100vw;height:100dvh;border-left:0}
  .drawer.open{right:0}
  .cart-fab{position:fixed; top:12px; right:12px; z-index:60;
    width:54px; height:54px; border-radius:999px; display:flex; align-items:center; justify-content:center;
    background:var(--brand); color:#fff; border:0; box-shadow:0 10px 24px rgba(0,0,0,.25); font-size:22px; font-weight:900;}
  .cart-fab .badge{position:absolute; top:-6px; right:-6px; background:#000; color:#fff; border-radius:999px; padding:2px 7px; font-size:12px; font-weight:800;}
}
</style>
</head>
<body>

<div class="band-top"></div>
<div class="band-bottom"></div>

<header class="header">
  <div class="container row">
    <div class="brand">
      <div class="logo">HA</div>
      <div class="name">Hadeejâ€™Art</div>
    </div>
    <div class="actions">
      <button id="openCart" class="icon-btn">ðŸ›’ <span id="cartCount">0</span></button>
    </div>
  </div>
</header>

<main class="container">
  <section class="hero">
    <div>
      <h1 class="title">Style africain, coupe moderne.</h1>
      <p class="subtitle">PiÃ¨ces artisanales colorÃ©es â€” choisissez taille, couleur, et commandez directement.</p>
      <div class="cta-row"><button id="ctaHero" class="cta-hero">Voir le catalogue</button></div>
      <div class="smallnote">Astuce : utilisez <b>DÃ©tail</b> pour choisir la couleur, la taille (XSâ€“XXL) et le sexe si nÃ©cessaire.</div>
    </div>
    <div>
      <img src="https://images.unsplash.com/photo-1603575448863-b1145d3bba9c?q=80&w=800&auto=format&fit=crop" alt="Look africain">
    </div>
  </section>

  <h2 id="catalogue">Catalogue</h2>
  <section id="productGrid" class="grid"></section>
</main>

<footer class="container">
  Â© <span id="y"></span> Hadeejâ€™Art â€” Tous droits rÃ©servÃ©s.
</footer>

<!-- Mobile cart FAB -->
<button id="openCartMobile" class="cart-fab" aria-label="Panier">
  ðŸ›’<span id="cartCountM" class="badge">0</span>
</button>

<!-- Drawer Cart -->
<div id="backdrop" class="backdrop"></div>
<aside class="drawer" id="cartDrawer" aria-hidden="true">
  <div class="wrap">
    <header><b>Votre panier</b><button class="icon-btn" id="closeCart">Fermer</button></header>
    <div class="items" id="cartItems"></div>
    <div class="totals">
      <div class="line"><span>Sous-total</span><b id="subTotal">0 FCFA</b></div>
      <div class="line"><span>Livraison</span><b>Ã€ dÃ©finir</b></div>
    </div>
    <div class="checkout">
      <button class="btn" id="finalizeBtn">Finaliser</button>
    </div>
  </div>
</aside>

<!-- Invoice Modal -->
<div id="modal" class="modal" aria-hidden="true">
  <div class="modal-content">
    <div class="modal-header">
      <h3 id="modalTitle">Facture</h3>
      <button class="icon-btn" id="modalClose">Fermer</button>
    </div>
    <div class="modal-body" id="modalBody"></div>
    <div class="modal-footer">
      <div class="smallnote">PrÃ©visualisation. Le total nâ€™inclut pas la livraison.</div>
    </div>
  </div>
</div>

<!-- Customer Info Modal -->
<div id="custModal" class="modal" aria-hidden="true" style="display:none">
  <div class="modal-content" role="dialog" aria-labelledby="custTitle">
    <div class="modal-header">
      <h3 id="custTitle">Mes informations</h3>
      <button class="icon-btn" id="closeCust">Fermer</button>
    </div>
    <div class="modal-body" style="display:flex;flex-direction:column;gap:10px">
      <label>Nom complet
        <input id="custName" type="text" placeholder="ex: AÃ¯cha Diop" required>
      </label>
      <label>TÃ©lÃ©phone (WhatsApp)
        <input id="custPhone" type="tel" placeholder="77 123 45 67" required>
      </label>
      <label>Adresse
        <textarea id="custAddr" rows="2" placeholder="Quartier, ville"></textarea>
      </label>
      <label style="display:flex;gap:8px;align-items:center;margin-top:6px">
        <input id="custRemember" type="checkbox" checked>
        <span>MÃ©moriser mes infos sur cet appareil</span>
      </label>
      <div class="smallnote">Vos donnÃ©es restent <b>sur cet appareil</b>. Vous pouvez les effacer Ã  tout moment.</div>
    </div>
    <div class="modal-footer" style="display:flex;gap:10px;justify-content:flex-end">
      <button class="btn secondary" id="clearCust">Oublier mes infos</button>
      <button class="btn" id="saveCust">Continuer</button>
    </div>
  </div>
</div>

<script>
// UTIL
const el = (q,ctx=document)=>ctx.querySelector(q);
const els= (q,ctx=document)=>Array.from(ctx.querySelectorAll(q));
function fcfa(n){ return (n||0).toLocaleString('fr-FR')+' FCFA' }

// PRODUCTS (ajoute tes images dans /images et mets le chemin dans "img")
const PRODUCTS=[
  {id:'kimono-long',name:"Kimono Long",price:8000,img:"images/kimono-long.jpg"},
  {id:'boob',name:"Boob (bob africain)",price:2500,img:"images/boob.jpg"},
  {id:'ensemble-short',name:"Ensemble Short",price:7000,img:"images/ensemble-short.jpg"},
  {id:'pantalon',name:"Pantalon",price:3000,img:"images/pantalon.jpg"},
  {id:'veste',name:"Veste Wax",price:12000,img:"images/veste.jpg"},
  {id:'robe',name:"Robe Wax",price:9000,img:"images/robe.jpg"}
];

// CART
var CART=[];
function renderProducts(){
  const grid = el('#productGrid'); grid.innerHTML='';
  PRODUCTS.forEach(p=>{
    const card = document.createElement('article'); card.className='card';
    card.innerHTML = `
      <img src="${p.img}" alt="${p.name}" onerror="this.src='https://images.unsplash.com/photo-1603575448863-b1145d3bba9c?q=80&w=800&auto=format&fit=crop'">
      <div class="body">
        <div class="name">${p.name}</div>
        <div class="price">${fcfa(p.price)}</div>
        <div class="row">
          <button class="btn" data-add="${p.id}">Acheter</button>
          <button class="btn secondary" data-detail="${p.id}">DÃ©tail</button>
        </div>
      </div>`;
    grid.appendChild(card);
  });
}
function refreshCart(){
  const box = el('#cartItems'); box.innerHTML='';
  let subtotal=0;
  CART.forEach((it,idx)=>{
    subtotal += it.price*it.qty;
    const row = document.createElement('div'); row.className='item';
    row.innerHTML=`
      <img src="${it.img||'https://images.unsplash.com/photo-1603575448863-b1145d3bba9c?q=80&w=800&auto=format&fit=crop'}" alt="">
      <div class="meta">
        <b>${it.name}</b>
        <div class="opts">${[it.color, it.size, it.sex].filter(Boolean).join(' | ')||'â€”'}</div>
      </div>
      <div class="qty">
        <button class="icon-btn" data-dec="${idx}">-</button>
        <span>${it.qty}</span>
        <button class="icon-btn" data-inc="${idx}">+</button>
      </div>`;
    box.appendChild(row);
  });
  el('#subTotal').textContent=fcfa(subtotal);
  const count = CART.reduce((s,x)=>s+x.qty,0);
  el('#cartCount').textContent=count;
  const cm = el('#cartCountM'); if (cm) cm.textContent = count;
}
function addToCart(pid, opts={}){
  const p = PRODUCTS.find(x=>x.id===pid); if(!p) return;
  const key = JSON.stringify({pid,color:opts.color||'',size:opts.size||'',sex:opts.sex||''});
  let item = CART.find(x=>x._k===key);
  if(!item){
    item = {_k:key, id:pid, name:p.name, price:p.price, img:p.img, qty:0, ...opts};
    CART.push(item);
  }
  item.qty++; refreshCart();
}

document.addEventListener('click', (e)=>{
  const t=e.target;
  if (t.matches('[data-add]')) addToCart(t.getAttribute('data-add'));
  if (t.matches('[data-detail]')) openDetail(t.getAttribute('data-detail'));
  if (t.matches('[data-inc]')){ CART[+t.getAttribute('data-inc')].qty++; refreshCart(); }
  if (t.matches('[data-dec]')){ let i=+t.getAttribute('data-dec'); CART[i].qty=Math.max(0,CART[i].qty-1); if(!CART[i].qty) CART.splice(i,1); refreshCart(); }
});

// Detail chooser
function openDetail(pid){
  const p = PRODUCTS.find(x=>x.id===pid); if(!p) return;
  const modal = el('#modal'); const body = el('#modalBody'); const title = el('#modalTitle');
  title.textContent = 'DÃ©tail â€” '+p.name;
  body.innerHTML = `
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;align-items:start">
      <img src="${p.img}" style="width:100%;border-radius:12px;border:1px solid #00000012;object-fit:cover" alt="${p.name}">
      <div>
        <label>Couleur
          <input id="optColor" placeholder="ex: Orange">
        </label>
        <label style="display:block;margin-top:8px">Taille
          <select id="optSize">
            <option>XS</option><option>S</option><option>M</option><option>L</option><option>XL</option><option>XXL</option>
          </select>
        </label>
        <label style="display:block;margin-top:8px">Sexe
          <select id="optSex">
            <option value="">â€”</option><option>Femme</option><option>Homme</option><option>Unisexe</option>
          </select>
        </label>
        <div class="row" style="margin-top:12px">
          <button class="btn" id="addWithOpts">Ajouter au panier</button>
        </div>
      </div>
    </div>`;
  modal.style.display='grid'; modal.setAttribute('aria-hidden','false');
  el('#addWithOpts').onclick=()=>{
    addToCart(pid,{ color:el('#optColor').value.trim(), size:el('#optSize').value, sex:el('#optSex').value });
    modalClose();
    openCart();
  }
}
function modalClose(){ const m=el('#modal'); m.style.display='none'; m.setAttribute('aria-hidden','true'); }
el('#modalClose').onclick = modalClose;
el('#modal').addEventListener('click',(e)=>{ if(e.target.id==='modal') modalClose(); });

// Cart open/close
function openCart(){
  const drawer=el('#cartDrawer'); el('#backdrop').classList.add('show');
  drawer.style.display='flex'; drawer.classList.add('open'); drawer.setAttribute('aria-hidden','false');
  document.body.classList.add('lock-scroll');
}
function closeCart(){
  const drawer=el('#cartDrawer'); el('#backdrop').classList.remove('show');
  drawer.classList.remove('open'); drawer.setAttribute('aria-hidden','true'); drawer.style.display='none';
  document.body.classList.remove('lock-scroll');
}
el('#openCart').onclick = openCart;
el('#closeCart').onclick = closeCart;
el('#backdrop').onclick = closeCart;

// Hero CTA scroll
el('#ctaHero').onclick = ()=> el('#productGrid').scrollIntoView({behavior:'smooth',block:'start'});

// Mobile cart button
const cmBtn = el('#openCartMobile');
if (cmBtn){ cmBtn.addEventListener('click', ()=>{ openCart(); window.scrollTo({top:0,behavior:'smooth'}); }); }

// Year
el('#y').textContent = new Date().getFullYear();

// Invoice drawing (proportionally scaled, no stretch)
function showInvoice(name, phone, addr){
  const orderId = "HA-" + Math.random().toString(36).slice(2,8).toUpperCase();
  const total = CART.reduce((s,x)=>s+x.price*x.qty,0);
  const modal = el('#modal'); const body = el('#modalBody'); const title = el('#modalTitle');
  title.textContent = "Facture â€” " + orderId;
  body.innerHTML = `
    <div class="smallnote">AperÃ§u A4 (raffinÃ©). AjustÃ© automatiquement sans dÃ©formation.</div>
    <div class="inv-wrap"><canvas id="inv" class="invoice" width="794" height="1123"></canvas></div>
    <div style="display:flex;gap:10px;margin-top:10px;justify-content:center;flex-wrap:wrap">
      <button class="btn" id="sendWA">Passer la commande</button>
      <button class="btn secondary" id="dlInv">TÃ©lÃ©charger la facture (PNG)</button>
    </div>`;
  modal.style.display='grid'; modal.setAttribute('aria-hidden','false');

  const cv = el("#inv"); const ctx = cv.getContext('2d');
  const NAT_W = 794, NAT_H = 1123, RATIO = NAT_H / NAT_W;
  const sheet = el("#modalBody");
  const maxW = Math.min(sheet.clientWidth - 32, NAT_W);
  const maxH = Math.min(window.innerHeight * 0.75, NAT_H);
  let dispW = maxW, dispH = Math.round(maxW * RATIO);
  if (dispH > maxH) { dispH = Math.floor(maxH); dispW = Math.floor(dispH / RATIO); }
  cv.style.width  = dispW + "px"; cv.style.height = dispH + "px";
  const dpr = Math.min(window.devicePixelRatio || 1, 2);
  const s = dispW / NAT_W; cv.width  = Math.floor(NAT_W * dpr * s); cv.height = Math.floor(NAT_H * dpr * s); ctx.scale(dpr*s, dpr*s);

  function RRect(x,y,w,h,r){ ctx.beginPath(); ctx.moveTo(x+r,y); ctx.arcTo(x+w,y,x+w,y+h,r); ctx.arcTo(x+w,y+h,x,y+h,r); ctx.arcTo(x,y+h,x,y,r); ctx.arcTo(x,y,x+w,y,r); ctx.closePath(); }
  function text(txt,x,y,fs=22,fw="normal",color="#2b1e12",align="left"){ ctx.fillStyle=color; ctx.font = fw+" "+fs+"px Poppins, Arial"; ctx.textAlign = align; ctx.fillText(txt,x,y); }
  function line(x1,y1,x2,y2,color="#00000014",w=1){ ctx.strokeStyle=color; ctx.lineWidth=w; ctx.beginPath(); ctx.moveTo(x1,y1); ctx.lineTo(x2,y2); ctx.stroke(); }

  // page
  ctx.fillStyle = "#ffffff"; RRect(8,8,NAT_W-16,NAT_H-16,16); ctx.fill();
  ctx.strokeStyle = "#0000001a"; ctx.lineWidth = 1; RRect(8,8,NAT_W-16,NAT_H-16,16); ctx.stroke();
  // header
  const padX=40; const right = NAT_W - padX;
  ctx.fillStyle = "#d47a2c"; RRect(8,8,NAT_W-16,90,16); ctx.fill();
  text("Hadeejâ€™Art",padX+70,60,40,"bold","#fff");
  text("Facture / Invoice",padX+72,84,18,"bold","#ffffffcc");

  // client & order
  text("Client",padX,150,20,"bold");
  text(name||"",padX,178,20); text("TÃ©l: "+(phone||""),padX,204,18); text("Adresse: "+(addr||""),padX,230,18);
  const colR = right-40; text("Commande",colR,150,20,"bold","#000","right");
  text("ID: "+orderId,colR,178,18,"normal","#000","right");
  text(new Date().toLocaleString('fr-FR'),colR,204,16,"normal","#000","right");

  // table header
  let y=280;
  ctx.fillStyle = "#F3CFB8"; RRect(padX,y,NAT_W-2*padX,34,8); ctx.fill();
  text("Article",padX+14,y+23,16,"bold"); text("Options",padX+400,y+23,16,"bold"); text("QtÃ©",padX+540,y+23,16,"bold"); text("Prix",padX+600,y+23,16,"bold"); text("Total",padX+660,y+23,16,"bold");
  y += 42; line(padX,y,NAT_W-padX,y);

  // rows
  let i=0; let subtotal=0;
  CART.forEach(it=>{
    const rowH = 34;
    if (i%2==0){ ctx.fillStyle="#00000006"; ctx.fillRect(padX,y-2,NAT_W-2*padX,rowH+4); }
    text(it.name,padX+14,y+22,16,"normal");
    text(( (it.color||'')+" | "+(it.size||'')+(it.sex? " | "+it.sex:"")).replace(/^ \| /,''),padX+400,y+22,14,"normal");
    text(String(it.qty),padX+540,y+22,16,"normal","#000","left");
    text((it.price).toLocaleString('fr-FR'),padX+600,y+22,16,"normal","#000","left");
    text((it.price*it.qty).toLocaleString('fr-FR'),padX+660,y+22,16,"bold","#000","left");
    y += rowH; i++; subtotal += it.price*it.qty;
    line(padX,y,NAT_W-padX,y,"#00000010");
  });

  // totals card
  y += 18;
  const cardW = 260, cardH = 110, cardX = right-cardW, cardY = y;
  ctx.fillStyle="#ffffff"; RRect(cardX,cardY,cardW,cardH,12); ctx.fill();
  ctx.strokeStyle="#0000001a"; ctx.lineWidth=1; RRect(cardX,cardY,cardW,cardH,12); ctx.stroke();
  text("Sous-total:",cardX+14,cardY+34,18,"bold"); text(subtotal.toLocaleString('fr-FR')+" FCFA",cardX+cardW-14,cardY+34,18,"bold","#000","right");
  text("Livraison:",cardX+14,cardY+60,18,"bold"); text("Ã€ dÃ©finir",cardX+cardW-14,cardY+60,18,"bold","#000","right");
  ctx.fillStyle="#d47a2c"; RRect(cardX+10,cardY+74,cardW-20,32,8); ctx.fill();
  text("Total:",cardX+22,cardY+96,20,"bold","#fff"); text(subtotal.toLocaleString('fr-FR')+" FCFA",cardX+cardW-22,cardY+96,20,"bold","#fff","right");

  // footer
  text("Merci pour votre confiance.",padX,NAT_H-50,14,"bold","#6f5a4a");
  text("Contact WhatsApp: +221781444340",padX,NAT_H-30,13,"normal","#6f5a4a");

  function downloadCanvas(){ const a=document.createElement('a'); a.download=`Facture_${orderId}.png`; a.href=cv.toDataURL('image/png'); a.click(); }
  el("#dlInv").onclick = downloadCanvas;
  el("#sendWA").onclick = () => {
    downloadCanvas();
    const lines = ["*Nouvelle commande â€” Hadeejâ€™Art*","ID: "+orderId,"Client: "+(name||""),"TÃ©l: "+(phone||""),"Adresse: "+(addr||""),"----",...CART.map(it => `â€¢ ${it.name} â€” ${it.qty} x ${(it.price).toLocaleString('fr-FR')} FCFA (${(it.color||'')}${(it.size?' | '+it.size:'')}${(it.sex?' | '+it.sex:'')})`),"----","Total: "+(subtotal).toLocaleString('fr-FR')+" FCFA"];
    const msg = encodeURIComponent(lines.join("\\n"));
    window.open(`https://wa.me/221781444340?text=${msg}`, "_blank");
  };
}

// Customer memory (localStorage)
const CUST_KEY = "hadeejart_customer_v1";
function getSavedCustomer(){ try{ return JSON.parse(localStorage.getItem(CUST_KEY))||null }catch(e){ return null } }
function saveCustomer(d){ localStorage.setItem(CUST_KEY, JSON.stringify({...d, savedAt: Date.now()})); }
function clearCustomer(){ localStorage.removeItem(CUST_KEY); }
function openCustModal(prefill){
  const m = el('#custModal');
  const name = el('#custName'), phone = el('#custPhone'), addr = el('#custAddr'), remember = el('#custRemember');
  if(prefill){ name.value=prefill.name||''; phone.value=prefill.phone||''; addr.value=prefill.addr||''; } else { name.value=phone.value=addr.value=''; remember.checked=true; }
  m.style.display='grid'; m.setAttribute('aria-hidden','false');
  el('#closeCust').onclick = ()=>{ m.style.display='none'; m.setAttribute('aria-hidden','true'); };
  el('#clearCust').onclick = ()=>{ clearCustomer(); name.value=phone.value=addr.value=''; remember.checked=false; };
  el('#saveCust').onclick = ()=>{
    if(!name.value.trim() || !phone.value.trim()){ alert('Merci de renseigner au moins le nom et le tÃ©lÃ©phone.'); return; }
    const data = { name:name.value.trim(), phone:phone.value.trim(), addr:addr.value.trim() };
    if(remember.checked) saveCustomer(data);
    m.style.display='none'; m.setAttribute('aria-hidden','true');
    showInvoice(data.name, data.phone, data.addr);
  };
  m.onclick = (e)=>{ if(e.target===m) { m.style.display='none'; m.setAttribute('aria-hidden','true'); } };
}

// Finalize -> ask / reuse customer
el('#finalizeBtn').onclick = ()=>{
  let cartNow = (CART && CART.length) ? CART : (JSON.parse(localStorage.getItem('hadeejart_cart_v1')||'[]'));
  if(!cartNow || !cartNow.length){ alert('Votre panier est vide.'); return; }
  CART = cartNow;
  const saved = getSavedCustomer();
  if(saved && (saved.name || saved.phone)){ showInvoice(saved.name, saved.phone, saved.addr||''); }
  else{ openCustModal(null); }
};

// ===== Patches: persist cart & keep badge synced
(function(){
  const KEY="hadeejart_cart_v1";
  try{
    const stored = JSON.parse(localStorage.getItem(KEY)||'[]');
    if (Array.isArray(stored) && stored.length){
      CART.length=0; stored.forEach(x=>CART.push(x));
    }
  }catch(_){}
  const _ref = refreshCart;
  refreshCart = function(){ _ref.apply(this, arguments); try{ localStorage.setItem(KEY, JSON.stringify(CART)); }catch(_){} }
})();

// Hide WhatsApp button on mobile (if any)
(function(){
  const isMobile = window.matchMedia('(max-width: 720px)').matches;
  if (!isMobile) return;
  Array.from(document.querySelectorAll('a,button')).forEach(el=>{
    if ((el.textContent||'').trim().toLowerCase().includes('whatsapp')){
      el.style.display='none';
      el.setAttribute('data-hidden-wa','1');
    }
  });
})();

// Image update helper
window.HadeejArt = window.HadeejArt || {};
window.HadeejArt.updateImages = function(map){
  const cards = document.querySelectorAll('.card');
  cards.forEach(card=>{
    const titleEl = card.querySelector('.name, .title, h3, h4');
    const imgEl = card.querySelector('img');
    if (!titleEl || !imgEl) return;
    const title = titleEl.textContent.trim().toLowerCase();
    for (const key in map){
      const k = String(key).trim().toLowerCase();
      if (title.includes(k)){ imgEl.src = map[key]; }
    }
  });
};

// Boot
renderProducts(); refreshCart();
</script>
</body>
</html>
